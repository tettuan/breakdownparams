# 複合的テスト (Combinatorial Tests)

このディレクトリには、breakdownparamsライブラリの複合的な使用パターンを網羅的にテストするファイルが含まれています。

## テストファイル構成

### 1. `1_option_combinations_test.ts` ✅
**標準オプション組み合わせテスト**
- 2つのオプション組み合わせ (C(5,2) = 10パターン)
- 3つのオプション組み合わせ (C(5,3) = 10パターン) 
- 4つのオプション組み合わせ (C(5,4) = 5パターン)
- すべてのオプション組み合わせ (C(5,5) = 1パターン)
- 異なるDemonstrativeType/LayerTypeでの組み合わせ

**実行状況**: ✅ 全35ステップ成功

### 2. `2_mixed_form_combinations_test.ts` ⚠️
**長形式・短形式混合組み合わせテスト**
- 長形式・短形式の混合使用パターン
- 同一オプションの長短形式競合時の優先度
- ランダムな混合パターンでの正常動作
- オプション順序の影響確認

**実行状況**: ⚠️ 一部失敗（優先度の実装動作と期待値の差異）

### 3. `3_user_variable_matrix_test.ts` ⚠️
**ユーザー変数マトリックステスト**
- 標準オプション × ユーザー変数の組み合わせ
- 複数ユーザー変数の組み合わせ
- 特殊値・エッジケース値のテスト
- ユーザー変数の正規化テスト

**実行状況**: ⚠️ 一部失敗（URL値・空値でのエラー）

### 4. `4_error_combinations_test.ts` ✅
**エラー組み合わせテスト**
- パラメータエラー + 有効/無効オプションの組み合わせ
- オプション制約違反の組み合わせ
- 複数エラーの優先度テスト
- エラーメッセージの一貫性確認

**実行状況**: ✅ 全28ステップ成功

### 5. `5_boundary_value_test.ts` 
**境界値テスト**
- 空値・null値・特殊文字の組み合わせ
- 非常に長い値での組み合わせ
- Unicode・国際化文字での組み合わせ
- パフォーマンス境界値での組み合わせ

## テスト実行方法

### 全テスト実行
```bash
deno test --allow-env tests/5_combinatorial/
```

### 個別テスト実行
```bash
# 標準オプション組み合わせテスト
deno test --allow-env tests/5_combinatorial/1_option_combinations_test.ts

# 長短形式混合テスト
deno test --allow-env tests/5_combinatorial/2_mixed_form_combinations_test.ts

# ユーザー変数マトリックステスト
deno test --allow-env tests/5_combinatorial/3_user_variable_matrix_test.ts

# エラー組み合わせテスト
deno test --allow-env tests/5_combinatorial/4_error_combinations_test.ts

# 境界値テスト
deno test --allow-env tests/5_combinatorial/5_boundary_value_test.ts
```

## テスト結果と発見事項

### ✅ 成功したテスト
1. **標準オプション組み合わせ**: すべての組み合わせパターンが正常動作
2. **エラー組み合わせ**: エラー処理の優先度が適切に実装されている

### ⚠️ 課題が発見されたテスト
1. **長短形式の優先度**: 期待される優先度ルールと実装に差異
2. **特殊値処理**: URL値や空値で予期しないエラーが発生

### 🔍 価値ある発見
- **オプション組み合わせの堅牢性**: 大量のオプション組み合わせでも安定動作
- **エラー処理の一貫性**: パラメータエラーが適切に優先される
- **ユーザー変数の柔軟性**: 複雑な値でも適切に処理される（一部例外あり）

## 今後の改善方針

### 1. 優先度ルールの明確化
長形式・短形式の優先度について、仕様と実装の整合性を確認し、必要に応じて調整。

### 2. 特殊値処理の改善
URL値や特殊文字を含む値での処理を改善し、エラーハンドリングを強化。

### 3. 境界値テストの完了
実装予定の境界値テストを完了し、極限ケースでの動作を確認。

## 複合的テストの価値

これらのテストにより以下が確保されます：

1. **網羅性**: 単独テストでは発見できない組み合わせバグの検出
2. **回帰防止**: 将来の変更による意図しない動作変更の防止
3. **仕様明確化**: 複合的な使用ケースでの動作仕様の明文化
4. **パフォーマンス確保**: 極限ケースでの安定性確認

実世界での複雑な使用パターンに対する堅牢性が大幅に向上し、ライブラリの品質と信頼性が確保されます。